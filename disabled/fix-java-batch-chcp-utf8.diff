diff --git a/compiler/module_cmds.m b/compiler/module_cmds.m
index e0c7770..03aa23b 100644
--- a/compiler/module_cmds.m
+++ b/compiler/module_cmds.m
@@ -814,12 +814,24 @@ write_java_batch_file(Globals, MainModuleName, Stream, !IO) :-
     mangle_sym_name_for_java(MainModuleName, module_qual, ".", ClassName),
 
     io.write_strings(Stream, [
-        "@echo off\n",
-        "rem Automatically generated by the Mercury compiler.\n",
-        "setlocal\n",
-        "set DIR=%~dp0\n",
-        "set CLASSPATH=", ClassPath, "\n",
-        Java, " jmercury.", ClassName, " %*\n"
+        ":: Automatically generated by the Mercury compiler.\n",
+        "@setlocal enableextensions enabledelayedexpansion\n",
+        "@set DIR=%~dp0\n",
+        ":: Setting console output to UTF-8\n",
+        "@set newCP=65001\n",
+        "@for /F \"usebackq tokens=2 delims=:\" %%A in (`chcp`) do @(\n",
+        "    set oldCP=%%A\n",
+        "    set oldCP=!oldCP: =!\n",
+        "    set oldCP=!oldCP:.=!\n",
+        ")\n",
+        "@if %oldCP% NEQ %newCP% chcp %newCP% 1>nul\n",
+        "\n",
+        "@set CLASSPATH=", ClassPath, "\n",
+        "@", Java, " -Dfile.encoding=UTF-8 ", " jmercury.", ClassName, " %*\n",
+        "@set javaResult=%ERRORLEVEL%\n",
+        ":: Restoring the previous codepage\n",
+        "@if %oldCP% NEQ %newCP% chcp %oldCP% 1>nul\n",
+        "@exit /b %javaResult%\n"
     ], !IO).
 
     % NOTE: changes here may require changes to get_mercury_std_libs.
